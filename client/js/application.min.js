function crewListController(e,o,t,r,n){var s=this;s.showModal=!1,s.notifModal={},e.activeTab={},e.activeTab.crewList=!0,n.getUserStatus().then(function(e){o.get("/api/users/"+e.data.user._id+"/contacts").success(function(e){s.currentUser=e,"crew"===s.currentUser.role&&r.go("profile"),s.inviteUrl="http://myproducer.io/#/register?r="+e._id,s.ready=!0,console.log(e)})}),s.addContact=function(){o.post("/api/users/addcontact",s.newContact).success(function(e){if(s.newContact.email="",console.log(e),e)if(e.success){s.notifModal.isSuccess=!0;var o=e.data.username;s.notifModal.content="You have successfully added "+o+" to your crew list.",s.currentUser.contacts.push(e.data)}else s.notifModal.isFailure=!0,s.notifModal.content=e.message;else s.notifModal.isSuccess=!0,s.notifModal.content="We have sent an invitation to "+s.newContact.email+" to  be part of your crew list."}).error(function(e){s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.openNotifModal()})},s.closeModal=function(e){"modal-container"===e.target.getAttribute("id")&&(s.selectedUserId=void 0,s.showModal=!1)},s.openModal=function(){s.showModal=!0},s.handleAddToButton=function(e,o){s.selectedUserId=e,s.selectedUsername=o,console.log(s.selectedUserId),s.openModal()},s.addCrewToProduction=function(e,t){var r={to:s.selectedUserId,production:e};console.log(r),o.post("/api/crew/",r).success(function(e){console.log(e),s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully added "+s.selectedUsername+" to "+t+"."}).error(function(e){console.log(e),s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.openNotifModal()})},s.openNotifModal=function(){s.notifModal.show=!0},s.closeNotifModal=function(){s.notifModal.show=!1,s.notifModal.isSuccess=!1,s.notifModal.isFaiure=!1}}function homeController(e,o,t){var r=this;e.isLoggedIn&&(console.log("ding"),o.go("profile")),t.reg&&(r.registerIntent=!0)}function loginController(e,o,t,r){var n=this;e.activeTab={},n.userRole=t.ur,e.isLoggedIn&&(console.log("go to proile"),o.go("profile")),n.login=function(){n.error=!1,n.disabled=!0,r.login(n.loginForm.username,n.loginForm.password).then(function(){console.log("Successful login..."),o.go("profile"),n.disabled=!1,n.loginForm={}}).catch(function(){console.log("Whoops..."),n.error=!0,n.errorMessage="Invalid email and/or password",n.disabled=!1,n.loginForm={}})}}function logoutController(e,o,t){var r=this;e.activeTab={},r.logout=function(){t.logout().then(function(){o.go("login"),e.isLoggedIn=!1})}}function mainController(e,o,t){var r=this;e.activeTab={},e.isLoggedIn=!1,e.$on("$stateChangeStart",function(o){t.getUserStatus().then(function(o){r.currentUser=o.data.user,r.currentUser&&(e.isLoggedIn=!0)})})}function offerController(e,o,t,r,n){var s=this;s.currentUser={},e.activeTab={},o.getUserStatus().then(function(e){s.currentUser=e.data.user,t.get("/api/users/"+s.currentUser._id).success(function(e){s.currentUser=e,t.get("/api/crew/"+r.id).success(function(e){s.crew=e,s.isProducer=s.crew.production.by_._id===s.currentUser._id,s.isCrew=s.crew.production.by_._id!==s.currentUser._id,s.ready=!0,console.log("Crew from get",s.crew)})})}),s.addMessage=function(e){s.message={content:e||s.newMessage},s.message.content&&t.post("/api/crew/"+s.crew._id+"/message?crew="+s.crew.to.username+"&producer="+s.crew.production.by_.username,s.message).success(function(e){s.crew.message=e,s.newMessage=""})},s.updateOfferStatus=function(e){s.offerUpdate=Object.assign({},s.crew),s.offerUpdate.offer.status=e,t.patch("/api/crew/"+r.id,s.offerUpdate).then(function(o){var t="";"Accepted"==e?(t="I accept your offer to work with you on "+s.crew.production.name+".",s.addMessage(t)):"Declined"==e&&(t="I respectfully decline your offer to work with you on "+s.crew.production.name+".",s.addMessage(t))})},s.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e}}function otherProfileController(e,o,t,r,n){var s=this;s.modal={},s.modal.show=!1,s.currentUser={},e.activeTab={},n.getUserStatus().then(function(e){s.currentUser=e.data.user,o.get("/api/users/"+s.currentUser._id).success(function(e){s.currentUser=e,console.log(e),o.get("/api/users/"+t.id+"/profile").then(function(e){s.user=e.data,s.isPending=s.currentUser.pendingContacts.find(function(e){return e===s.user._id}),s.ready=!0})})}),s.updateContactStatus=function(e){console.log(e),console.log(t.id),o.patch("/api/users/updateContact?of="+t.id+"&status="+e).then(function(o){s.modal.content="You have "+e+"d offer to join your crew list.",s.showModal()},function(){s.modal.content="An error has occurred. Please try again.",s.showModal()})},s.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e},s.showModal=function(){s.modal.show=!0},s.closeModal=function(){s.modal.show=!1}}function postController(e,o,t,r,n){var s=this;s.currentUser={},s.editingState=!1,s.modal={},s.modal.show=!1,e.activeTab={},e.activeTab.profile=!0,n.getUserStatus().then(function(e){o.get("/api/users/"+e.data.user._id+"/profile").success(function(e){s.currentUser=e;var o=[];e.offersReceived.forEach(function(e){"Accepted"===e.offer.status&&o.push(e.production)}),s.currentUser.allProductions=e.productions.concat(o),s.ready=!0,console.log(e)})}),s.editUser=function(){o.patch("/api/users/"+s.currentUser._id,s.currentUser).success(function(e){e.productions=s.currentUser.productions,e.offersReceived=s.currentUser.offersReceived,s.currentUser=e,s.modal.isSuccess=!0,s.modal.content="You have successfully updated your profile."}).error(function(e){s.modal.isFailure=!0,s.modal.content="An error has occurred. Please try again."}).finally(function(){s.editingState=!1,s.openModal()})},s.openModal=function(){s.modal.show=!0},s.closeModal=function(){s.modal.show=!1,s.modal.isSuccess=!1,s.modal.isFailure=!1},s.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e}}function productionController(e,o,t,r,n){var s=this;s.offers=[],s.currentUser={},e.activeTab={},e.activeTab.production=!0,s.notifModal={},s.editingState=!1,n.getUserStatus().then(function(e){s.currentUser=e.data.user,o.get("/api/users/"+s.currentUser._id+"/contacts").success(function(e){s.currentUser=e,console.log(e),o.get("/api/productions/"+t.id).success(function(e){s.production=e,console.log("Production from the Factory",s.production),s.isProducer=s.production.by_._id===s.currentUser._id,s.ready=!0})})}),s.editProduction=function(){o.patch("/api/productions/"+t.id,s.production).success(function(e){s.editingState=!1,console.log(e),e.crew=s.production.crew,s.production=e,s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully updated your production."}).error(function(e){console.log(e),s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.openNotifModal()})},s.deleteProduction=function(){o.delete("/api/productions/"+t.id).success(function(e){r.go("production-list")})},s.makeOffer=function(e,t){var r=s.offers[t];s.offer={offer:{status:"Pending",position:r.position,rate:r.rate,hours:r.hours}},o.patch("api/crew/"+e,s.offer).success(function(r){console.log(r),s.production.crew[t].offer.hours=r.offer.hours,s.production.crew[t].offer.position=r.offer.position,s.production.crew[t].offer.rate=r.offer.rate,s.production.crew[t].offer.status=r.offer.status,s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully sent on offer to "+s.production.crew[t].to.username+".",s.message={content:"I would like to invite you to be part of my production team."},s.message.content&&o.post("/api/crew/"+e+"/message",s.message).success(function(e){console.log(e)})}).error(function(e){s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.openNotifModal()})},s.addToCrew=function(e){crewOffer={to:e,production:t.id},o.post("/api/crew/",crewOffer).success(function(e){s.production.crew=e,s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully added a new crew member."}).error(function(e){s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.showModal=!1,s.openNotifModal()})},s.removeFromCrew=function(e,t){o.delete("/api/crew/"+e).then(function(o){o.data.success?(s.production.crew=s.production.crew.filter(function(o){return o._id.toString()!=e}),s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully removed a crew member."):(s.notifModal.isFailure=!1,s.notifModal.content="An error has occurred. Please try again.")}).catch(function(e){s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.openNotifModal()})},s.closeModal=function(e){"modal-container"===e.target.getAttribute("id")&&(s.selectedUserId=void 0,s.showModal=!1)},s.openModal=function(){s.showModal=!0},s.openNotifModal=function(){s.notifModal.show=!0},s.closeNotifModal=function(){s.notifModal.show=!1,s.notifModal.isSuccess=!1,s.notifModal.isFailure=!1},s.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e},s.notifyCrew=function(){o.get("/api/productions/"+t.id+"/notify").success(function(e){console.log(e),s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully sent an email notification to your crew members.",s.openNotifModal()})}}function productionListController(e,o,t,r,n){var s=this;s.notifModal={},e.activeTab={},e.activeTab.production=!0,n.getUserStatus().then(function(e){o.get("/api/users/"+e.data.user._id+"/productions").success(function(e){s.currentUser=e;var o=[];e.offersReceived.forEach(function(e){"Accepted"===e.offer.status&&o.push(e.production)}),s.currentUser.allProductions=e.productions.concat(o),s.ready=!0,"producer"===s.currentUser.role&&s.updateMinDateTo()})});var i=new Date(Date.now());s.dateFrom=i,s.dateFrom.setHours(0),s.dateFrom.setMinutes(0),s.dateFrom.setSeconds(0),s.dateFrom.setMilliseconds(0),s.minDateFrom=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate(),s.updateMinDateTo=function(){var e=new Date(s.dateFrom);s.minDateTo=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),document.getElementById("prod-date-to").setAttribute("min",s.minDateTo),new Date(s.dateFrom)>new Date(s.dateTo)&&(s.dateTo=void 0,s.notifModal.isFailure=!0,s.notifModal.content="Please check date!",s.notifModal.show=!0)},s.addProduction=function(){var e={from:new Date(s.dateFrom),to:new Date(s.dateTo),by_:s.currentUser,name:s.newProduction.name};o.post("/api/productions",e).success(function(e){s.currentUser.allProductions=s.currentUser.productions.concat(e)})},s.deleteProduction=function(e,t){o.patch("/api/productions/"+t,{active:!1}).success(function(o){console.log(o),s.currentUser.allProductions=s.currentUser.allProductions.filter(function(e,o){return e._id.toString()!=t}),s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully deleted "+e}).error(function(e){console.log(e),s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.openNotifModal()})},s.openNotifModal=function(){s.notifModal.show=!0},s.closeNotifModal=function(){s.notifModal.show=!1,s.notifModal.isSuccess=!1,s.notifModal.isFailure=!1},s.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e}}function registerController(e,o,t,r){var n=this;e.activeTab={},e.isLoggedIn?(console.log("go to proile"),o.go("profile")):void 0===t.ur&&o.go("home",{reg:!0}),n.register=function(){n.error=!1,n.disabled=!0,r.register(n.registerForm,t.ur,t).then(function(){o.go("profile"),n.disabled=!1,n.registerForm={}}).catch(function(){n.error=!0,n.errorMessage="Something went wrong!",n.disabled=!1,n.registerForm.username="",n.registerForm.password=""})}}var myApp=angular.module("myApp",["ui.router"]);myApp.config(["$stateProvider","$urlRouterProvider",function(e,o){o.otherwise("/"),e.state("home",{url:"/?reg",templateUrl:"templates/home.html",controller:"homeController as homeCtrl"}).state("login",{url:"/login?ur",templateUrl:"templates/login.html",controller:"loginController as loginCtrl"}).state("logout",{url:"/logout",templateUrl:"templates/logout.html",controller:"logoutController",restricted:!0}).state("register",{url:"/register?p&r&ur",templateUrl:"templates/register.html",controller:"registerController as registerCtrl"}).state("crew-list",{url:"/crewlist",templateUrl:"templates/crewList.html",controller:"crewListController as crewListCtrl",restricted:!0}).state("production",{url:"/production/:id",templateUrl:"templates/production.html",controller:"productionController as productionCtrl",restricted:!0}).state("production-list",{url:"/productions",templateUrl:"templates/productionList.html",controller:"productionListController as productionListCtrl",restricted:!0}).state("profile",{url:"/profile",templateUrl:"templates/profile.html",controller:"postController as postCtrl",restricted:!0}).state("otherProfile",{url:"/profile/:id",templateUrl:"templates/otherProfile.html",controller:"otherProfileController as otherProfileCtrl",restricted:!0}).state("offer",{url:"/offer/:id",templateUrl:"templates/offer.html",controller:"offerController as offerCtrl",restricted:!0})}]),myApp.run(["$rootScope","$location","$state","AuthService",function(e,o,t,r){e.$on("$stateChangeError",console.log.bind(console)),e.$on("$stateChangeStart",function(e,o,n,s,i){r.getUserStatus().then(function(){o.restricted&&!r.isLoggedIn()&&t.go("login")})})}]),angular.module("myApp").factory("AuthService",["$q","$timeout","$http",function(e,o,t){function r(){return!!a}function n(){return t.get("/user/status").success(function(e){a=!!e.status}).error(function(e){a=!1})}function s(o,r){var n=e.defer();return t.post("/user/login",{username:o,password:r}).success(function(e,o){200===o&&e.status?(a=!0,n.resolve()):(a=!1,n.reject())}).error(function(e){a=!1,n.reject()}),n.promise}function i(){var o=e.defer();return t.get("/user/logout").success(function(e){a=!1,o.resolve()}).error(function(e){a=!1,o.reject()}),o.promise}function c(o,r,n){var s=e.defer();if(n.p)var i="/user/register?addTo="+n.p;else if(n.r)var i="/user/register?requestTo="+n.r;else var i="/user/register";return console.log(i),t.post(i,{username:o.username,first_name:o.first_name,last_name:o.last_name,password:o.password,role:r}).success(function(e,o){200===o&&e.status?s.resolve():s.reject()}).error(function(e){s.reject()}),s.promise}var a=null;return{isLoggedIn:r,getUserStatus:n,login:s,logout:i,register:c}}]),angular.module("myApp").controller("crewListController",crewListController),crewListController.$inject=["$rootScope","$http","$stateParams","$state","AuthService"],angular.module("myApp").controller("homeController",homeController),homeController.$inject=["$rootScope","$state","$stateParams"],angular.module("myApp").controller("loginController",loginController),loginController.$inject=["$rootScope","$state","$stateParams","AuthService"],angular.module("myApp").controller("logoutController",logoutController),logoutController.$inject=["$rootScope","$state","AuthService"],angular.module("myApp").controller("mainController",mainController),mainController.$inject=["$rootScope","$state","AuthService"],angular.module("myApp").controller("offerController",offerController),offerController.$inject=["$rootScope","AuthService","$http","$stateParams","$state"],angular.module("myApp").controller("otherProfileController",otherProfileController),otherProfileController.$inject=["$rootScope","$http","$stateParams","$state","AuthService"],angular.module("myApp").controller("postController",postController),postController.$inject=["$rootScope","$http","$stateParams","$state","AuthService"],angular.module("myApp").controller("productionController",productionController),productionController.$inject=["$rootScope","$http","$stateParams","$state","AuthService"],angular.module("myApp").controller("productionListController",productionListController),productionListController.$inject=["$rootScope","$http","$stateParams","$state","AuthService"],angular.module("myApp").controller("registerController",registerController),registerController.$inject=["$rootScope","$state","$stateParams","AuthService"];