function accountSettingController(e,t,o,r,n){console.log("accountSettingController instantiated");var a=this;a.disabled=!1,a.modalChangePassword=!1,e.activeTab.profile=!1,e.activeTab.crewList=!1,e.activeTab.production=!1,r.getUserStatus().then(function(e){a.user=e.data.user}),a.changePassword=function(){a.disabled=!0,n.post("/user/changePassword",{password:a.password,user:a.user}).success(function(e){e.success&&(a.modalChangePassword=!0)})},a.refresh=function(){t.reload()}}function completeRegistrationController(e,t,o,r){var n=this;n.modalOpen=!1,r.getUserStatus().then(function(e){r.checkCompRegToken(o.token).then(function(e){e.user||t.go("home")}),n.completeRegistration=function(e){n.disabled=!0,r.completeRegistration(o.token,n.registerForm).then(function(e){n.modalOpen=!0})}})}function crewListController(e,t,o,r,n,a,s){var i=this;i.showModal=!1,i.showModal2=!1,i.notifModal={},i.hoverApprovedCrew=!1,i.hoverPendingCrew=!1,e.activeTab={},e.activeTab.crewList=!0,n.getUserStatus().then(function(e){t.get("/api/users/"+e.data.user._id+"/contacts").success(function(e){i.currentUser=e,"crew"===i.currentUser.role&&r.go("profile"),i.inviteUrl="https://app.myproducer.io/#/register?r="+e._id+"&ur=crew",i.ready=!0})}),s.parse_file=function(e){const t=e.files[0],o={complete:function(e,t){i.handleCsvResults(e.data)}};Papa.parse(t,o)},i.handleCsvResults=function(e){for(var t=0;t<e.length;t++)i.checkForEmptyField(e[t])},i.checkForEmptyField=function(e){for(var t=[],o=0;o<e.length;o++)""!=e[o]&&t.push(e[o]);return i.makeContactObject(t)},i.makeContactObject=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(0!=e.length&&t.test(e[2])){var o={first_name:e[0],last_name:e[1],email:e[2]};i.pushToUserContacts(o)}else if(0==t.test(e[2])){var r={};i.pushToUserContacts(r)}},i.pushToUserContacts=function(e){t.post("/api/users/addcontact",e).success(function(e){e&&e.success&&i.currentUser.contacts.push(e.data)}).error(function(e){i.notifModal.isFailure=!0,i.notifModal.content="An error has occurred. Please double check your csv format.",i.notifModal.show=!0}).finally(function(){i.closeModal2()})},i.errorHandler=function(e){"NotReadableError"==e.target.error.name&&alert("Canno't read file !")},i.addContact=function(){t.post("/api/users/addcontact",i.newContact).success(function(e){if(i.newContact.email="",i.newContact.first_name="",i.newContact.last_name="",a.track("Add Contact Clicked",{user:i.currentUser.username}),e)if(e.success){i.notifModal.isSuccess=!0,i.notifModal.isFailure=!1;var t=e.data.first_name,o=e.data.last_name;i.notifModal.content="You have successfully added "+t+" "+o+" to your approved contact list.",i.currentUser.contacts.push(e.data)}else e.newSuccess?(i.notifModal.isSuccess=!0,i.notifModal.content="We have sent an invitation to "+e.newEmail+". They will appear in your crew list once they accept."):(i.notifModal.isFailure=!0,i.notifModal.content=e.message);else i.notifModal.isSuccess=!0,i.notifModal.content="We have sent an invitation to "+i.newContact.email+". They will appear in your crew list when they accept."}).error(function(e){i.notifModal.isFailure=!0,i.notifModal.content="An error has occurred. Please try again."}).finally(function(){i.openNotifModal()})},i.deleteContact=function(e){t.patch("/api/users/delete-contact",{contact:e,currentUser:i.currentUser}).success(function(e){i.currentUser.contacts=e.user.contacts})},i.closeModal=function(e){"modal-container"===e.target.getAttribute("id")&&(i.selectedUserId=void 0,i.showModal=!1)},i.openModal=function(){i.showModal=!0},i.openModal2=function(){i.showModal2=!0},i.closeModal2=function(){i.showModal2=!1},i.openDeleteContactModal=function(e){i.contact=e,i.showDeleteContactModal=!0},i.handleAddToButton=function(e,t){i.selectedUserId=e,i.selectedUsername=t,i.openModal()},i.addCrewToProduction=function(e,o){var r={to:i.selectedUserId,production:e};t.post("/api/crew/",r).success(function(e){i.notifModal.isSuccess=!0,i.notifModal.content="You have successfully added "+i.selectedUsername+" to "+o+"."}).error(function(e){i.notifModal.isFailure=!0,i.notifModal.content="An error has occurred. Please try again."}).finally(function(){i.openNotifModal()})},i.openNotifModal=function(){i.notifModal.show=!0},i.closeNotifModal=function(){i.notifModal.show=!1,i.notifModal.isSuccess=!1,i.notifModal.isFaiure=!1},i.closeDeleteContactModal=function(){i.showDeleteContactModal=!1},i.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e}}function forgotPasswordController(e,t,o,r,n){console.log("forgotPasswordController instantiated");var a=this;a.modalOpen=!1,a.modal2Open=!1,a.forgot=function(e){a.disabled=!0,n.forgotPassword(e).then(function(e){"resolved"==e.message?a.modalOpen=!0:(a.modal2Open=!0,a.disabled=!1)})}}function homeController(e,t,o){var r=this;e.isLoggedIn&&t.go("profile"),o.reg&&(r.registerIntent=!0)}function loginController(e,t,o,r){var n=this;e.activeTab={},n.userRole=o.ur,e.isLoggedIn&&t.go("profile"),n.login=function(){n.error=!1,n.disabled=!0,r.login(n.loginForm.username,n.loginForm.password).then(function(){"/offer/:id"===e.returnToState?t.go("offer",{id:e.returnToStateParams}):"/production/:id"===e.returnToState?t.go("production",{id:e.returnToStateParams}):t.go("profile"),n.disabled=!1,n.loginForm={}}).catch(function(){n.error=!0,n.errorMessage="Invalid email and/or password",n.disabled=!1,n.loginForm={}})}}function logoutController(e,t,o){var r=this;e.activeTab={},r.logout=function(){o.logout().then(function(){t.go("login"),e.isLoggedIn=!1})}}function mainController(e,t,o,r){var n=this;n.isNotLogin=!0,n.isLogin=!1,n.dropDown=!1,n.upgradeable=!0,n.showDropdown=function(){0==n.dropDown?n.dropDown=!0:n.dropDown=!1},n.upgradeAccount=function(){t.go("profile",{upgradeModal:!0})},e.activeTab={},e.isLoggedIn=!1,e.$on("$stateChangeStart",function(t){o.getUserStatus().then(function(t){n.currentUser=t.data.user,void 0!=n.currentUser&&(n.currentUser.stripeAccount||n.currentUser.stripePlan)&&(n.upgradeable=!1),n.currentUser&&(e.isLoggedIn=!0)})}),e.$on("$stateChangeSuccess",function(e){r.path(),n.isNotLogin=!1,n.isLogin=!0})}function offerController(e,t,o,r,n,a){var s=this;s.currentUser={},e.activeTab={},t.getUserStatus().then(function(e){s.currentUser=e.data.user,1==e.data.status?o.get("/api/users/"+s.currentUser._id).success(function(e){}):void 0===s.currentUser&&(s.currentUser={_id:""}),o.get("/api/crew/"+r.id).success(function(e){console.log(e),s.crew=e,s.isCrew=s.crew.to,s.isProducer=s.crew.production.by_._id===s.currentUser._id,s.ready=!0})}),s.checkIfLoggedIn=function(){if(""==s.currentUser._id)return s.showVerificationModal=!0;n.go("production",{id:s.crew.production._id})},s.addMessage=function(e){s.messageBox=document.getElementById("message-box"),s.message={content:e||s.newMessage},s.message.content&&o.post("/api/crew/"+s.crew._id+"/message?crew="+s.crew.to.username+"&producer="+s.crew.production.by_.username,s.message).success(function(e){s.crew.message=e,s.newMessage="",s.messageBox.focus()})},s.updateOfferStatus=function(e){if(""==s.currentUser._id)return s.showVerificationModal=!0;s.offerUpdate=Object.assign({},s.crew),s.offerUpdate.offer.status=e,o.patch("/api/crew/"+r.id+"/status",s.offerUpdate).then(function(t){var o="";"Accepted"==e?(o="I accept your offer to work with you on "+s.crew.production.name+".",s.addMessage(o)):"Declined"==e&&(o="I respectfully decline your offer to work with you on "+s.crew.production.name+".",s.addMessage(o))})},s.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e},s.redirectCompReg=function(){n.go("complete-registration",{token:s.crew.to.resetPasswordToken})}}function otherProfileController(e,t,o,r,n){var a=this;a.modal={},a.modal.show=!1,a.currentUser={},e.activeTab={},e.activeTab.crewList=!0,n.getUserStatus().then(function(e){a.currentUser=e.data.user,t.get("/api/users/"+a.currentUser._id).success(function(e){a.currentUser=e,t.get("/api/users/"+o.id+"/profile").then(function(e){if(a.user=e.data,a.first_name=a.user.first_name.charAt(0).toUpperCase()+a.user.first_name.slice(1),a.resume=a.user.resume||"",a.user.website){a.user.website[0]&&a.user.website[1]&&"w"===a.user.website[2]&&(a.user.website="http://"+a.user.website)}a.user.picture?a.profilePicture=a.user.picture:a.profilePicture="./img/profile_default.png",a.isPending=a.currentUser.pendingContacts.find(function(e){return e===a.user._id}),a.ready=!0})})}),a.updateContactStatus=function(e,r){t.patch("/api/users/updateContact?of="+o.id+"&status="+e).then(function(t){a.modal.content="approve"==e?"You have added "+r.first_name.capitalize()+" "+r.last_name.capitalize()+" as an approved contact.":"You have declined to add "+r.first_name.capitalize()+" "+r.last_name.capitalize()+" as an approved contact.",a.isPending=!1,a.showModal()},function(){a.modal.content="An error has occurred. Please try again.",a.showModal()})},a.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e},a.setIframeSrc=function(){document.getElementById("resumeElement").src=a.resume},a.showModal=function(){a.modal.show=!0},a.openModal3=function(){a.modal.show3=!0},a.closeModal3=function(){a.modal.show3=!1},a.closeModal=function(){a.modal.show=!1},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}function pendingCrewController(e,t,o,r,n){var a=this;a.currentUser={},a.modal={},a.modal2={},a.pendingList=[],a.modal.show=!1,a.modal2.show=!1,a.leftButton=!0,a.rightButton=!0,n.getUserStatus().then(function(e){t.get("/api/users/"+e.data.user._id+"/contacts").success(function(e){a.currentUser=e,a.currentUser.pendingContacts.forEach(function(e){a.pendingList.push(e._id)}),a.currentIndex=a.pendingList.indexOf(o.id),0===a.currentIndex&&1===a.pendingList.length?(a.leftButton=!1,a.rightButton=!1):0===a.currentIndex?a.leftButton=!1:a.currentIndex==a.pendingList.length-1&&(a.rightButton=!1),t.get("/api/users/"+o.id+"/profile").then(function(e){a.user=e.data,a.first_name=a.user.first_name.charAt(0).toUpperCase()+a.user.first_name.slice(1),a.resume=a.user.resume||"",a.user.picture?a.profilePicture=a.user.picture:a.profilePicture="./img/profile_default.png",a.isPending=a.currentUser.pendingContacts.find(function(e){return e._id===a.user._id}),a.ready=!0})})}),a.updateContactStatus=function(e,n){t.patch("/api/users/updateContact?of="+o.id+"&status="+e).then(function(t){"approve"==e?(a.modal.content="You have added "+n.first_name.capitalize()+" "+n.last_name.capitalize()+" as an approved contact.",a.showModal(),setTimeout(function(){0==a.currentIndex&&1==a.pendingList.length?r.go("crew-list"):a.currentIndex==a.pendingList.length-1?r.go("pending-crew",{id:a.pendingList[0]}):r.go("pending-crew",{id:a.pendingList[a.currentIndex+1]})},2e3)):(a.closeModal2(),0==a.currentIndex&&1==a.pendingList.length?r.go("crew-list"):a.currentIndex==a.pendingList.length-1?r.go("pending-crew",{id:a.pendingList[0]}):r.go("pending-crew",{id:a.pendingList[a.currentIndex+1]})),a.isPending=!1},function(){a.modal.content="An error has occurred. Please try again.",a.showModal()})},a.changeProfile=function(e){"left"==e?a.currentIndex-=1:"right"==e&&(a.currentIndex+=1),r.go("pending-crew",{id:a.pendingList[a.currentIndex]})},a.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e},a.showModal=function(){a.modal.show=!0},a.closeModal=function(){a.modal.show=!1},a.showModal2=function(e){a.modal2.content="Are you sure you want to decline "+e.first_name.capitalize()+" "+e.last_name.capitalize()+" as an approved contact.",a.modal2.show=!0},a.closeModal2=function(){a.modal2.show=!1},a.setIframeSrc=function(){document.getElementById("resumeElement").src=a.resume},a.openModal3=function(){a.modal.show3=!0},a.closeModal3=function(){a.modal.show3=!1},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}function postController(e,t,o,r,n,a,s){function i(e){if(e){var t=e.length;0==t?c.rows=4:t<75?c.rows=1:t>74&&t<150?c.rows=2:t>149&&t<225?c.rows=3:t>224&&t<300?c.rows=4:t>299&&t<375?c.rows=5:t>374&&t<425?c.rows=6:t>424&&t<500?c.rows=7:t>499&&t<575?c.rows=8:t>574&&t<650?c.rows=9:t>649&&t<725?c.rows=10:t>724&&t<800?c.rows=11:t>799&&t<875?c.rows=12:t>874&&t<950?c.rows=13:t>949&&(c.rows=14)}else c.rows=4}var c=this;c.hoverPending=!1,c.hoverCurrent=!1,c.hoverPast=!1,c.currentUser={},c.editingState=!1,c.fileInput=document.getElementById("file-input"),c.modal={},c.showSaveButton=!0,c.googleLocation="",c.upgradeModal={},e.activeTab={},e.activeTab.profile=!0,r.params.upgradeModal===!0&&(c.upgradeModal.show=!0),n.getUserStatus().then(function(e){t.get("/api/users/"+e.data.user._id+"/profile").success(function(e){c.currentUser=e,c.first_name=c.currentUser.first_name.charAt(0).toUpperCase()+c.currentUser.first_name.slice(1),c.resume=c.currentUser.resume||"",i(c.currentUser.bio);var t=[];e.offersReceived.forEach(function(e){"Accepted"===e.offer.status&&t.push(e.production)}),c.currentUser.picture?c.profilePicture=c.currentUser.picture+"?random="+Math.random():c.profilePicture="./img/profile_default.png",c.currentUser.allProductions=e.productions.concat(t),console.log(c.currentUser),c.ready=!0})}),c.loadGooglePlaces=function(){c.locationInput=document.getElementById("userLocation");var e={types:["geocode"]},t=new google.maps.places.Autocomplete(c.locationInput,e);t.addListener("place_changed",function(){t.getPlace();c.googleLocation=c.locationInput.value})},a.file_changed=function(e){document.getElementById("profile-pic-preview").src=URL.createObjectURL(e.files[0]),c.showSaveButton=!1},a.resume_chosen=function(e){const t=e.files[0];t.randomName=c.currentUser._id+"."+Date.now()+".pdf",c.resumeSignedRequest(t)},c.resumeSignedRequest=function(e){const t=new XMLHttpRequest;t.open("GET","/uploads/sign-s3?file-name="+e.randomName+"&file-type="+e.type),t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status){const o=JSON.parse(t.responseText);c.avatarUrl=o.url,c.uploadResume(e,o.signedRequest,o.url),s.track("Resume Uploaded",{user:c.currentUser.username})}else alert("Could not get signed URL.")},t.send()},c.uploadResume=function(e,t,o){const r=new XMLHttpRequest;r.open("PUT",t),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?(c.resumeUrl=o,c.addResumeToProfile()):alert("Could not upload file."))},r.send(e)},c.addResumeToProfile=function(){t.patch("/api/users/"+c.currentUser._id,{resume:c.resumeUrl}).then(function(e){c.resume=e.data.resume})},c.deleteResume=function(){t.patch("/api/users/"+c.currentUser._id,{resume:""}).then(function(e){c.resume=""})},c.editUser=function(){c.locationInput&&(c.googleLocation=c.locationInput.value,c.currentUser.location=c.locationInput.value),t.patch("/api/users/"+c.currentUser._id,c.currentUser).success(function(e){console.log(e),c.currentUser.location=e.location}).error(function(e){c.modal.isFailure=!0,c.modal.content="An error has occurred. Please try again."}).finally(function(){1==c.editingState1?c.editingState1=!1:1==c.editingState2?c.editingState2=!1:1==c.editingState3?c.editingState3=!1:1==c.editingState4&&(c.editingState4=!1)})},c.setIframeSrc=function(){document.getElementById("resumeElement").src=c.resume},c.openModal=function(){c.modal.show=!0},c.openModal2=function(){c.modal.show2=!0,c.showSaveButton=!0},c.openModal3=function(){c.modal.show3=!0},c.closeModal=function(){c.modal.show=!1,c.modal.isSuccess=!1,c.modal.isFailure=!1},c.closeModal2=function(){c.modal.show2=!1},c.closeModal3=function(){c.modal.show3=!1},c.openUpgradeModal=function(){c.upgradeModal.show=!0},c.closeUpgradeModal=function(){c.upgradeModal.show=!1,c.upgradeModal.isSuccess=!1,c.upgradeModal.isFailure=!1},c.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e},c.getOfferId=function(e){for(var t="",o=0;o<c.currentUser.offersReceived.length;o++)c.checkIdMatching(c.currentUser.offersReceived[o]._id,e)&&(t=c.checkIdMatching(c.currentUser.offersReceived[o]._id,e));return t},c.checkIdMatching=function(e,t){for(var o=0;o<t.crew.length;o++)if(e==t.crew[o])return e},c.initUpload=function(){var e=document.getElementById("file-input").files;if(file=e[0],file.randomName=c.currentUser._id+"."+file.name.split(".").pop(),null==file)return alert("No file selected.");c.getSignedRequest(file)},c.getSignedRequest=function(e){const t=new XMLHttpRequest;t.open("GET","/uploads/sign-s3?file-name="+e.randomName+"&file-type="+e.type),t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status){const o=JSON.parse(t.responseText);c.avatarUrl=o.url,c.uploadFile(e,o.signedRequest,o.url),c.addAvatarToProfile(),s.track("Profile Picture Uploaded",{user:c.currentUser.username})}else alert("Could not get signed URL.")},t.send()},c.uploadFile=function(e,t,o){const r=new XMLHttpRequest;r.open("PUT",t),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?document.getElementById("profile-picture").src=o+"?random="+Math.random():alert("Could not upload file."))},r.send(e)},c.addAvatarToProfile=function(){t.patch("/api/users/"+c.currentUser._id,{picture:c.avatarUrl}).then(function(e){c.profilePicture=e.data.picture+"?random="+Math.random(),c.closeModal2()})}}function premiumController(e,t,o,r){var n=this;n.plan=o.plan.toUpperCase(),e.activeTab={},t.params.error&&(n.error=!0,n.errorMessage="Something went wrong!",n.disabled=!1),n.register=function(){t.go("stripe",{plan:o.plan,form:n.registerForm})}}function productionController(e,t,o,r,n,a){var s=this;s.offers=[],s.currentUser={},e.activeTab={},e.activeTab.production=!0,s.hoverHire=!1,s.notifModal={},s.editingState=!1,s.googleLocation1="",s.googleLocation2="",s.loadGooglePlaces=function(){s.location1=document.getElementById("location1").innerHTML,s.location2=document.getElementById("location2").innerHTML,s.googleLocations=[s.location1,s.location2],s.locationInput1=document.getElementById("production1Location"),s.locationInput2=document.getElementById("production2Location");var e=new google.maps.places.Autocomplete(s.locationInput1),t=new google.maps.places.Autocomplete(s.locationInput2);e.addListener("place_changed",function(){const t=e.getPlace();s.googleLocation1=t.formatted_address,s.googleLocations[0]=s.googleLocation1}),t.addListener("place_changed",function(){const e=t.getPlace();s.googleLocation2=e.formatted_address,s.googleLocations[1]=s.googleLocation2})},n.getUserStatus().then(function(e){s.currentUser=e.data.user,t.get("/api/users/"+s.currentUser._id+"/contacts").success(function(e){s.currentUser=e,t.get("/api/productions/"+o.id).success(function(e){s.production=e,s.isProducer=s.production.by_._id===s.currentUser._id,s.ready=!0})})}),s.editProduction=function(){(s.locationInput1||s.locationInput2)&&(s.production.location[0]=s.locationInput1.value,s.production.location[1]=s.locationInput2.value),t.patch("/api/productions/"+o.id,s.production).success(function(e){s.editingState=!1,e.crew=s.production.crew,s.production=e,s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully updated your production."}).error(function(e){s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.openNotifModal()})},s.deleteProduction=function(){t.delete("/api/productions/"+o.id).success(function(e){r.go("production-list")})},s.makeOffer=function(e,o){if(s.offers[o])if(s.offers[o].position)if(s.offers[o].rate)if(s.offers[o].hours){var r=s.offers[o];s.offer={offer:{status:"Pending",position:r.position,rate:r.rate,hours:r.hours}},t.patch("api/crew/"+e,s.offer).success(function(r){s.production.crew[o].offer.hours=r.offer.hours,s.production.crew[o].offer.position=r.offer.position,s.production.crew[o].offer.rate=r.offer.rate,s.production.crew[o].offer.status=r.offer.status,s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully sent on offer to "+s.production.crew[o].to.username+".",s.message={content:"I would like to invite you to be part of my production team."},s.message.content&&t.post("/api/crew/"+e+"/message",s.message).success(function(e){}),a.track("Hire Clicked",{user:s.currentUser.username})}).error(function(e){s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.openNotifModal(),s.error=!1})}else s.error=!0,s.errorMessage="Please Provide Hours";else s.error=!0,s.errorMessage="Please Provide Rate";else s.error=!0,s.errorMessage="Please Select a Position";else s.error=!0,s.errorMessage="Please Fill Out Entire Offer"},s.addToCrew=function(e){console.log(e),crewOffer={to:e,production:o.id},t.post("/api/crew/",crewOffer).success(function(e){s.production.crew=e,s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully added a new crew member.",a.track("Add Crew Clicked",{user:s.currentUser.username})}).error(function(e){s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.showModal=!1,s.openNotifModal()})},s.removeFromCrew=function(e,o){t.delete("/api/crew/"+e).then(function(t){t.data.success?(s.production.crew=s.production.crew.filter(function(t){return t._id.toString()!=e}),s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully removed a crew member."):(s.notifModal.isFailure=!1,s.notifModal.content="An error has occurred. Please try again.")}).catch(function(e){s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.openNotifModal()})},s.closeModal=function(e){"modal-container"===e.target.getAttribute("id")&&(s.selectedUserId=void 0,s.showModal=!1)},s.openModal=function(){s.showModal=!0},s.openNotifModal=function(){s.notifModal.show=!0},s.closeNotifModal=function(){s.notifModal.show=!1,s.notifModal.isSuccess=!1,s.notifModal.isFailure=!1},s.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e},s.notifyCrew=function(){t.get("/api/productions/"+o.id+"/notify").success(function(e){s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully sent an email notification to your crew members.",s.openNotifModal(),a.track("Notify Crew Clicked")})},s.addContact=function(){t.post("/api/users/addcontact",s.newContact).success(function(e){if(s.newContact.email="",s.newContact.first_name="",s.newContact.last_name="",a.track("Add Contact Clicked",{user:s.currentUser.username}),e)if(e.success){s.notifModal.isSuccess=!0;var t=e.data.username;s.notifModal.content="You have successfully added "+t+" to your crew list.",s.currentUser.contacts.push(e.data)}else e.newSuccess?(s.notifModal.isSuccess=!0,s.notifModal.content="We have sent an invitation to "+e.newEmail+". They will appear in your crew list once they accept."):(s.notifModal.isFailure=!0,s.notifModal.content=e.message);else s.notifModal.isSuccess=!0,s.notifModal.content="We have sent an invitation to "+s.newContact.email+". They will appear in your crew list when they accept."}).error(function(e){s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."}).finally(function(){s.openNotifModal()})},s.openDeleteContactModal=function(e){console.log(e),s.contact=e,s.showDeleteContactModal=!0},s.closeDeleteContactModal=function(){s.showDeleteContactModal=!1},s.deleteContact=function(e){t.patch("/api/users/delete-contact",{contact:e,currentUser:s.currentUser}).success(function(e){s.currentUser.contacts=e.user.contacts})},splitNotes=function(e){var t=e.split("\n\n");s.production.notes=t}}function myRepeatDirective(e,t,o,r,n){return function(t,o,a){var s=[];n.cancel(s[a.myRepeatDirectiveIndex]),s[a.myRepeatDirectiveIndex]=n(function(){t.$eval(a.myRepeatDirective)},1.5*a.myRepeatDirectiveLength);var i=[],c=[],l={label:"",productions:[]},u=document.querySelector("body"),d=angular.element(u).scope();i.push($(".draggable")),i[0].each(function(){$(this).draggable({axis:"y",containment:"parent",snap:!0,snapMode:"inner"})}),c.push($(".droppable")),c[0].each(function(){$(this).droppable({drop:function(t,o){const n={productionId:"",tagId:""};if(n.productionId=o.draggable.children()[0].id,$(this).parent().is("div")&&$(this).parent()[0].classList.contains("accordion"))n.tagId=$(this).parent().children("p")[0].id,o.draggable.addClass("accordion-panel"),o.draggable.draggable("disable"),o.draggable.css("display","block"),$(this).parent().append(o.draggable),e.patch("/api/tag/addproduction",n).success(function(e){console.log(e)});else{var a=$("#directive-modal");a.css("display","table");var s=$("#directive-modal-input"),i=$("#directive-modal-button");console.log($(this).children()),l.productions.push($(this).children()[0].id),l.productions.push(o.draggable.children()[0].id),i.on("click",function(){var t=s.val();a.css("display","none"),l.label=t,e.post("/api/tag/newtag",l).success(function(e){d.userTaggables=e.taggables,r.go(r.current,{},{reload:!0})})})}}})})}}function productionListController(e,t,o,r,n,a){var s=this;s.hoverCreate=!1,s.upgradeModal={},s.notifModal={},e.activeTab={},e.activeTab.production=!0,s.productionsDraggable=[],s.productionsDroppable=[],r.params.upgradeModal===!0&&(s.upgradeModal.show=!0),n.getUserStatus().then(function(o){t.get("/api/users/"+o.data.user._id+"/productions").success(function(t){s.currentUser=t,s.userTaggables=s.currentUser.taggables,e.userTaggables=s.userTaggables;var o=[];t.offersReceived.forEach(function(e){"Accepted"===e.offer.status&&o.push(e.production)}),s.currentUser.allProductions=t.productions.concat(o),s.ready=!0})}),s.wholeAccordionClick=function(e){if(console.log(e.target.type),void 0==e.target.type){const t=e.target;$(e.target).children("p").children("img")[0].classList.toggle("active"),t.classList.toggle("active"),t.classList.contains("active")?$(t).children().show():$(t).children().not("p").not("button").hide()}},s.arrowAccordionClick=function(e){const t=e.target,o=$(t).parent().parent()[0];t.classList.toggle("active"),o.classList.toggle("active"),o.classList.contains("active")?$(o).children().show():$(o).children().not("p").not("button").hide()},s.checkIfTagged=function(e){var t=!1;return e.tag.length>0&&(t=!0),t},s.deleteTags=function(){t.delete("/api/tag/deletetags").success(function(e){console.log(e)})};var i=new Date(Date.now());s.dateFrom=i,s.dateFrom.setHours(0),s.dateFrom.setMinutes(0),s.dateFrom.setSeconds(0),s.dateFrom.setMilliseconds(0),s.minDateFrom=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate(),s.updateMinDateTo=function(){var e=new Date(s.dateFrom);s.minDateTo=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),document.getElementById("prod-date-to").setAttribute("min",s.minDateTo),new Date(s.dateFrom)>new Date(s.dateTo)&&(s.dateTo=void 0,s.notifModal.isFailure=!0,s.notifModal.content="Please check the production dates!",s.notifModal.show=!0)},s.addProduction=function(){if(!s.currentUser.stripePlan&&!s.currentUser.stripeAccount)return s.showCreateProdModal=!1,s.upgradeModal.isFailure=!0,s.upgradeModal.content="Oops! You must upgrade your account to do that",void(s.upgradeModal.show=!0);if(new Date(s.dateFrom)>new Date(s.dateTo))s.dateTo=void 0,s.notifModal.isFailure=!0,s.notifModal.content="Please check the production dates! Your production end date is before its start date",s.notifModal.show=!0;else{var e={from:new Date(s.dateFrom),to:new Date(s.dateTo),by_:s.currentUser,name:s.newProduction.name};t.post("/api/productions",e).success(function(e){s.currentUser.allProductions=s.currentUser.productions.concat(e),a.track("New Production Added",{user:s.currentUser.username,length:e.length}),s.closeCreateProdModal()})}},s.filterTag=function(e,t){return e=e.taggables.filter(function(e,o){return e._id!=t._id}),console.log(e),e},s.deleteProduction=function(o,r){t.patch("/api/productions/"+r,{active:!1}).success(function(t){if(t.tag)for(var n=0;n<e.userTaggables.length;n++)e.userTaggables[n].taggables=s.filterTag(e.userTaggables[n],t);s.currentUser.allProductions=s.currentUser.allProductions.filter(function(e,t){return e._id.toString()!=r}),s.notifModal.isSuccess=!0,s.notifModal.content="You have successfully deleted "+o,a.track("Production Deleted",{user:s.currentUser.username})}).error(function(e){s.notifModal.isFailure=!0,s.notifModal.content="An error has occurred. Please try again."})},s.openCreateProdModal=function(){s.showCreateProdModal=!0},s.closeCreateProdModal=function(){s.showCreateProdModal=!1},s.openNotifModal=function(){s.notifModal.show=!0},s.closeNotifModal=function(){s.notifModal.show=!1,s.notifModal.isSuccess=!1,s.notifModal.isFailure=!1},s.openUpgradeModal=function(){s.upgradeModal.show=!0},s.closeUpgradeModal=function(){s.upgradeModal.show=!1,s.upgradeModal.isSuccess=!1,s.upgradeModal.isFailure=!1},s.compareDate=function(e){return e=new Date(e),e.setDate(e.getDate()+1),!!e&&new Date<e},s.openDeleteProductionModal=function(e,t,o){s.productionName=e,s.productionID=t,s.$index=o,s.showDeleteProductionModal=!0},s.closeDeleteProductionModal=function(){s.showDeleteProductionModal=!1}}function registerController(e,t,o,r){var n=this;e.activeTab={},e.isLoggedIn?t.go("profile"):void 0===o.ur&&t.go("home",{reg:!0}),n.register=function(){n.error=!1,n.disabled=!0,r.register(n.registerForm,o.ur,o).then(function(){t.go("profile"),n.disabled=!1,n.registerForm={}}).catch(function(){n.error=!0,n.errorMessage="Something went wrong!",n.disabled=!1,n.registerForm.username="",n.registerForm.password=""})}}function resetPasswordController(e,t,o,r){console.log("resetPasswordController instantiated"),console.log(o.token);var n=this;n.modalOpen=!1,r.checkToken(o.token).then(function(e){e.user||t.go("home")}),n.resetPassword=function(e){n.disabled=!0,r.resetPassword(o.token,e).then(function(e){n.modalOpen=!0})}}function stripeCouponController(e,t,o,r,n){var a=this;n.getUserStatus().then(function(e){a.currentUser=e.data.user}),a.addCouponToUser=function(e){o.patch("/stripe/coupon",{user:a.currentUser}).success(function(e){console.log(e),t.go("profile")}).error(function(){t.go("stripe-coupon")})}}function stripeController(e,t,o,r,n){function a(e){var t=document.querySelector(".stripe-success"),o=document.querySelector(".stripe-error");t.classList.remove("visible"),o.classList.remove("visible"),e.token?(t.classList.add("visible"),s.makeStripeSubscription(e.token.id)):e.error&&(o.textContent=e.error.message,o.classList.add("visible"))}var s=this;s.premiumForm=t.params.form,s.planAmount="",s.coupon="","pro"===t.params.plan?s.planAmount="$50":"premium"===t.params.plan&&(s.planAmount="$25"),s.plan=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(t.params.plan),n.getUserStatus().then(function(e){o.get("/api/users/"+e.data.user._id+"/profile").success(function(e){s.currentUser=e})}),s.applyCoupon=function(){const e=document.getElementById("coupon").value;"beta"===e&&"pro"===t.params.plan?s.planAmount="$37.50":"beta"===e&&"premium"===t.params.plan&&(s.planAmount="$18.75")};var i=Stripe("pk_live_ia7M8gOjBo86Njp9ETWDxw1m"),c=i.elements(),l=c.create("card",{style:{base:{iconColor:"#666EE8",color:"#31325F",lineHeight:"40px",fontWeight:300,fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSize:"15px","::placeholder":{color:"#CFD7E0"}}}});l.mount("#card-element"),l.on("change",function(e){a(e)}),document.querySelector("form").addEventListener("submit",function(e){e.preventDefault();var t=document.querySelector("form"),o={name:t.querySelector("input[name=cardholder-name]").value};i.createToken(l,o).then(a)}),s.makeStripeSubscription=function(a){if("beta"===document.getElementById("coupon").value&&(s.coupon="alpha-coupon"),s.currentUser){const i={email:s.currentUser.username,plan:t.params.plan,source:a,user:s.currentUser,coupon:s.coupon};o.patch("/stripe/register/"+i.plan,{stripeData:i}).success(function(e){console.log(e),t.go("profile")}).error(function(){t.go("stripe",{plan:t.params.plan})})}else n.registerPremium(s.premiumForm,r.ur,t.params.plan).then(function(e){s.disabled=!1,s.premiumForm={};const r={
email:s.premiumForm.username,plan:t.params.plan,source:a,user:e.user,coupon:s.coupon};o.patch("/stripe/register/"+r.plan,{stripeData:r}).success(function(e){t.go("profile")}).error(function(){t.go("premium-register",{plan:t.params.plan,ur:"producer",error:!0})})}).catch(function(){t.go("premium-register",{plan:t.params.plan,ur:"producer",error:!0})}),e.activeTab={}}}var myApp=angular.module("myApp",["ui.router","ui.bootstrap","analytics.mixpanel","ngImgCrop"]);myApp.config(["$stateProvider","$urlRouterProvider","$mixpanelProvider",function(e,t,o){o.apiKey("15cd4875d9c8b7a226829c8fcf5ce560"),t.otherwise("/profile"),e.state("home",{url:"/?reg",templateUrl:"templates/home.html",controller:"homeController as homeCtrl"}).state("login",{url:"/login?ur",templateUrl:"templates/login.html",controller:"loginController as loginCtrl"}).state("logout",{url:"/logout",templateUrl:"templates/logout.html",controller:"logoutController",restricted:!0}).state("register",{url:"/register?p&r&ur",templateUrl:"templates/register.html",controller:"registerController as registerCtrl"}).state("premium-register",{url:"/register/premium?plan",templateUrl:"templates/premium.html",controller:"premiumController as premiumCtrl",params:{error:!1}}).state("stripe",{url:"/subscribe/:plan",templateUrl:"templates/stripe.html",controller:"stripeController as stripeCtrl",params:{form:null}}).state("stripe-coupon",{url:"/mpstaff",templateUrl:"templates/stripe-coupon.html",controller:"stripeCouponController as stripeCouponCtrl",restricted:!0}).state("complete-registration",{url:"/complete-registration/:token",templateUrl:"templates/complete-registration.html",controller:"completeRegistrationController as compRegCtrl"}).state("forgot-password",{url:"/forgot-password",templateUrl:"templates/forgot-password.html",controller:"forgotPasswordController as forgotPWCtrl"}).state("reset-password",{url:"/reset-password/:token",templateUrl:"templates/reset-password.html",controller:"resetPasswordController as resetPWCtrl"}).state("crew-list",{url:"/crewlist",templateUrl:"templates/crewList.html",controller:"crewListController as crewListCtrl",restricted:!0}).state("production",{url:"/production/:id",templateUrl:"templates/production.html",controller:"productionController as productionCtrl",restricted:!0}).state("production-list",{url:"/productions",templateUrl:"templates/productionList.html",controller:"productionListController as productionListCtrl",params:{upgradeModal:!1},restricted:!0}).state("profile",{url:"/profile",templateUrl:"templates/profile.html",controller:"postController as postCtrl",restricted:!0,params:{upgradeModal:!1}}).state("account-settings",{url:"/account-settings",templateUrl:"templates/account-settings.html",controller:"accountSettingController as accSetCtrl",restricted:!0}).state("otherProfile",{url:"/profile/:id",templateUrl:"templates/otherProfile.html",controller:"otherProfileController as otherProfileCtrl",restricted:!0}).state("offer",{url:"/offer/:id",templateUrl:"templates/offer.html",controller:"offerController as offerCtrl"}).state("pending-crew",{url:"/profile/pending/:id",templateUrl:"templates/pendingCrew.html",controller:"pendingCrewController as pendingCrewCtrl",restricted:!0})}]),myApp.run(["$rootScope","$location","$state","AuthService",function(e,t,o,r){e.$on("$stateChangeError",console.log.bind(console)),e.$on("$stateChangeStart",function(t,n,a,s,i){r.getUserStatus().then(function(t){n.restricted&&!r.isLoggedIn()&&(e.returnToState=n.url,e.returnToStateParams=a.id,o.go("login"))})})}]),angular.module("myApp").factory("AuthService",["$q","$timeout","$http","$state",function(e,t,o,r){function n(){return!!w}function a(){return o.get("/user/status").success(function(e){w=!!e.status}).error(function(e){w=!1})}function s(t,r){var n=e.defer();return o.post("/user/login",{username:t,password:r}).success(function(e,t){200===t&&e.status?(w=!0,n.resolve()):(w=!1,n.reject())}).error(function(e){w=!1,n.reject()}),n.promise}function i(){var t=e.defer();return o.get("/user/logout").success(function(e){w=!1,t.resolve()}).error(function(e){w=!1,t.reject()}),t.promise}function c(t,r,n){var a=e.defer();if(n.p)var s="/user/register?addTo="+n.p;else if(n.r)var s="/user/register?requestTo="+n.r;else var s="/user/register";return console.log(s),o.post(s,{username:t.username,first_name:t.first_name,last_name:t.last_name,password:t.password,role:r}).success(function(e,t){200===t&&e.status?a.resolve():a.reject()}).error(function(e){a.reject()}),a.promise}function l(t,r,n){var a=e.defer();const s=n;return o.post("/user/register",{username:t.username,first_name:t.first_name,last_name:t.last_name,password:t.password,role:"producer",plan:s}).success(function(e,t){200===t&&e.status?a.resolve(e):a.reject()}).error(function(e){a.reject()}),a.promise}function u(t){var r=e.defer();return o.post("/user/forgot-password",{email:t}).success(function(e,t){e.user===!1?r.resolve({message:"rejected"}):r.resolve({message:"resolved"})}).error(function(e){r.reject({message:"rejected"})}),r.promise}function d(t){var r=e.defer();return o.post("/user/check-token",{token:t}).success(function(e,t){if(200===t)r.resolve(e);else{r.reject()}}).error(function(e){w=!1,r.reject()}),r.promise}function p(t,r){var n=e.defer();return o.post("/user/reset/"+t,{password:r}).success(function(e,t){if(200===t)n.resolve(e);else{n.reject()}}).error(function(e){w=!1,n.reject()}),n.promise}function f(t){var r=e.defer();return o.post("/user/check-reg-token",{token:t}).success(function(e,t){if(200===t)r.resolve(e);else{r.reject()}}).error(function(e){w=!1,r.reject()}),r.promise}function g(t,r){var n=e.defer();return o.patch("/user/compReg/"+t,{registerForm:r}).success(function(e,t){if(200===t)n.resolve(e);else{n.reject()}}).error(function(e){w=!1,n.reject()}),n.promise}function m(t){console.log("getting crew status line 241");var r=e.defer();return o.get("/user/check-token",{id:t}).success(function(e){console.log(e),r.resolve(e)}).error(function(e){r.reject()}),r.promise}function h(e,t){}var w=null;return{isLoggedIn:n,getUserStatus:a,login:s,logout:i,register:c,registerPremium:l,forgotPassword:u,checkToken:d,resetPassword:p,completeRegistration:g,checkCompRegToken:f,getCrewStatus:m,makeStripeSubscription:h}}]),angular.module("myApp").controller("accountSettingController",accountSettingController),accountSettingController.$inject=["$rootScope","$state","$stateParams","AuthService","$http"],angular.module("myApp").controller("completeRegistrationController",completeRegistrationController),completeRegistrationController.$inject=["$rootScope","$state","$stateParams","AuthService"],angular.module("myApp").controller("crewListController",crewListController),crewListController.$inject=["$rootScope","$http","$stateParams","$state","AuthService","$mixpanel","$scope"],angular.module("myApp").controller("forgotPasswordController",forgotPasswordController),forgotPasswordController.$inject=["$rootScope","$state","$stateParams","$http","AuthService"],angular.module("myApp").controller("homeController",homeController),homeController.$inject=["$rootScope","$state","$stateParams"],angular.module("myApp").controller("loginController",loginController),loginController.$inject=["$rootScope","$state","$stateParams","AuthService"],angular.module("myApp").controller("logoutController",logoutController),logoutController.$inject=["$rootScope","$state","AuthService"],angular.module("myApp").controller("mainController",mainController),mainController.$inject=["$rootScope","$state","AuthService","$location"],angular.module("myApp").controller("offerController",offerController),offerController.$inject=["$rootScope","AuthService","$http","$stateParams","$state","$mixpanel"],angular.module("myApp").controller("otherProfileController",otherProfileController),otherProfileController.$inject=["$rootScope","$http","$stateParams","$state","AuthService"],angular.module("myApp").controller("pendingCrewController",pendingCrewController),pendingCrewController.$inject=["$rootScope","$http","$stateParams","$state","AuthService"],angular.module("myApp").controller("postController",postController),postController.$inject=["$rootScope","$http","$stateParams","$state","AuthService","$scope","$mixpanel"],angular.module("myApp").controller("premiumController",premiumController),premiumController.$inject=["$rootScope","$state","$stateParams","AuthService"],angular.module("myApp").controller("productionController",productionController),productionController.$inject=["$rootScope","$http","$stateParams","$state","AuthService","$mixpanel"],angular.module("myApp").controller("productionListController",productionListController).directive("myRepeatDirective",myRepeatDirective),productionListController.$inject=["$rootScope","$http","$stateParams","$state","AuthService","$mixpanel"],myRepeatDirective.$inject=["$http","AuthService","$rootScope","$state","$timeout"],angular.module("myApp").controller("registerController",registerController),registerController.$inject=["$rootScope","$state","$stateParams","AuthService"],angular.module("myApp").controller("resetPasswordController",resetPasswordController),resetPasswordController.$inject=["$rootScope","$state","$stateParams","AuthService"],angular.module("myApp").controller("stripeCouponController",stripeCouponController),stripeCouponController.$inject=["$rootScope","$state","$http","$stateParams","AuthService"],angular.module("myApp").controller("stripeController",stripeController),stripeController.$inject=["$rootScope","$state","$http","$stateParams","AuthService"];